"use strict";(self["webpackChunkblog_frontend"]=self["webpackChunkblog_frontend"]||[]).push([[858],{33858:(t,e,n)=>{n.r(e),n.d(e,{default:()=>d});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-management"},[e("el-card",{attrs:{shadow:"hover"}},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("评论管理")])]),e("el-form",{staticClass:"search-form",attrs:{inline:!0,model:t.searchForm}},[e("el-form-item",{attrs:{label:"文章标题"}},[e("el-input",{attrs:{placeholder:"文章标题",clearable:""},model:{value:t.searchForm.articleTitle,callback:function(e){t.$set(t.searchForm,"articleTitle",e)},expression:"searchForm.articleTitle"}})],1),e("el-form-item",{attrs:{label:"评论内容"}},[e("el-input",{attrs:{placeholder:"评论内容",clearable:""},model:{value:t.searchForm.content,callback:function(e){t.$set(t.searchForm,"content",e)},expression:"searchForm.content"}})],1),e("el-form-item",{attrs:{label:"状态"}},[e("el-select",{attrs:{placeholder:"评论状态",clearable:""},model:{value:t.searchForm.status,callback:function(e){t.$set(t.searchForm,"status",e)},expression:"searchForm.status"}},[e("el-option",{attrs:{label:"已审核",value:1}}),e("el-option",{attrs:{label:"待审核",value:0}})],1)],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.searchComments}},[t._v("查询")]),e("el-button",{on:{click:t.resetSearch}},[t._v("重置")])],1)],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.comments}},[e("el-table-column",{attrs:{type:"index",label:"序号",width:"80",index:t.indexMethod}}),e("el-table-column",{attrs:{prop:"articleTitle",label:"文章标题","min-width":"180"},scopedSlots:t._u([{key:"default",fn:function(n){return[e("el-tooltip",{attrs:{content:n.row.articleTitle,placement:"top",disabled:!n.row.articleTitle||n.row.articleTitle.length<20}},[e("span",[t._v(t._s(t._f("ellipsis")(n.row.articleTitle||"未知文章",20)))])])]}}])}),e("el-table-column",{attrs:{prop:"content",label:"评论内容","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(n){return[e("el-tooltip",{attrs:{content:n.row.content,placement:"top",disabled:n.row.content.length<30}},[e("span",[t._v(t._s(t._f("ellipsis")(n.row.content,30)))])])]}}])}),e("el-table-column",{attrs:{label:"评论人",width:"120"},scopedSlots:t._u([{key:"default",fn:function(n){return[e("span",[t._v(t._s(n.row.nickname||"匿名用户"))])]}}])}),e("el-table-column",{attrs:{label:"状态",width:"100"}},[[e("el-tag",{attrs:{type:"success"}},[t._v(" 已发布 ")])]],2),e("el-table-column",{attrs:{prop:"createTime",label:"评论时间",width:"180"}}),e("el-table-column",{attrs:{label:"操作",width:"250"},scopedSlots:t._u([{key:"default",fn:function(n){return[e("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.handleView(n.row)}}},[t._v("查看")]),e("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.handleDelete(n.row)}}},[t._v("删除")])]}}])})],1),e("div",{staticClass:"pagination-container"},[e("el-pagination",{attrs:{"current-page":t.pagination.current,"page-sizes":[10,20,30,50],"page-size":t.pagination.size,layout:"total, sizes, prev, pager, next, jumper",total:t.pagination.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),e("el-dialog",{attrs:{title:"评论详情",visible:t.dialogVisible,width:"600px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticClass:"comment-detail"},[e("div",{staticClass:"comment-item"},[e("div",{staticClass:"comment-header"},[e("span",{staticClass:"comment-author"},[t._v(t._s(t.currentComment.nickname))]),e("span",{staticClass:"comment-time"},[t._v(t._s(t.currentComment.createTime))])]),e("div",{staticClass:"comment-content"},[t._v(t._s(t.currentComment.content))]),e("div",{staticClass:"comment-article"},[e("span",[t._v("评论文章：")]),e("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(e){return t.viewArticle(t.currentComment.articleId)}}},[t._v(t._s(t.currentComment.articleTitle))])],1),e("div",{staticClass:"comment-info"},[e("span",[t._v("IP地址："+t._s(t.currentComment.ipAddress||"未知"))]),e("span",[t._v("设备信息："+t._s(t.currentComment.device||"未知"))])])]),t.currentComment.replyCount>0?e("div",{staticClass:"comment-reply"},[e("div",{staticClass:"reply-title"},[t._v("回复列表")]),e("div",{staticClass:"reply-list"},t._l(t.replies,function(n,a){return e("div",{key:a,staticClass:"reply-item"},[e("div",{staticClass:"reply-header"},[e("span",{staticClass:"reply-author"},[t._v(t._s(n.nickname))]),e("span",{staticClass:"reply-time"},[t._v(t._s(n.createTime))])]),e("div",{staticClass:"reply-content"},[t._v(t._s(n.content))])])}),0)]):t._e()]),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("关闭")]),e("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.handleDelete(t.currentComment)}}},[t._v("删除评论")])],1)])],1)},i=[],s=n(41034),o=(n(34782),n(26099),n(50788)),r=n.n(o);const l={name:"CommentManagement",data:function(){return{searchForm:{articleTitle:"",content:"",status:""},comments:[],loading:!1,pagination:{current:1,size:10,total:0},dialogVisible:!1,currentComment:{},replies:[]}},filters:{ellipsis:function(t,e){return t?t.length<=e?t:t.slice(0,e)+"...":""}},created:function(){this.fetchComments()},methods:{indexMethod:function(t){return t+1},fetchComments:function(){var t=this;this.loading=!0;var e=(0,s.A)({current:this.pagination.current,size:this.pagination.size},this.searchForm);r().get("/api/comment",{params:e,headers:{Authorization:this.$store.getters.token}}).then(function(e){e.data&&e.data.data&&(e.data.data.records?(t.comments=e.data.data.records,t.pagination.total=e.data.data.total):(t.comments=e.data.data,t.pagination.total=e.data.total||e.data.data.length))})["catch"](function(e){console.error("获取评论列表失败",e),t.$message.error("获取评论列表失败")})["finally"](function(){t.loading=!1})},searchComments:function(){this.pagination.current=1,this.fetchComments()},resetSearch:function(){this.searchForm={articleTitle:"",content:"",status:""},this.searchComments()},handleSizeChange:function(t){this.pagination.size=t,this.fetchComments()},handleCurrentChange:function(t){this.pagination.current=t,this.fetchComments()},handleView:function(t){var e=this;this.currentComment=(0,s.A)({},t),this.dialogVisible=!0,t.replyCount>0?r().get("/api/comment/".concat(t.id,"/replies"),{headers:{Authorization:this.$store.getters.token}}).then(function(t){e.replies=t.data.data||t.data})["catch"](function(t){console.error("获取评论回复失败",t),e.$message.error("获取评论回复失败")}):this.replies=[]},handleApprove:function(t){var e=this;this.$confirm("确认审核通过该评论吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){r().put("/api/comment/".concat(t.id,"/approve"),{},{headers:{Authorization:e.$store.getters.token}}).then(function(){e.$message.success("审核通过成功"),e.fetchComments(),e.dialogVisible&&(e.dialogVisible=!1)})["catch"](function(t){console.error("审核评论失败",t),e.$message.error("审核评论失败")})})["catch"](function(){})},handleDelete:function(t){var e=this;this.$confirm("确认删除该评论吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){r()["delete"]("/api/comment/".concat(t.id),{headers:{Authorization:e.$store.getters.token}}).then(function(){e.$message.success("删除成功"),e.fetchComments(),e.dialogVisible&&(e.dialogVisible=!1)})["catch"](function(t){console.error("删除评论失败",t),e.$message.error("删除评论失败")})})["catch"](function(){})},viewArticle:function(t){var e=this.$router.resolve({path:"/article/".concat(t)});window.open(e.href,"_blank")}}},c=l;var m=n(81656),u=(0,m.A)(c,a,i,!1,null,"94bf0a98",null);const d=u.exports}}]);
//# sourceMappingURL=858.9877768f.js.map