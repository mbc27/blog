"use strict";(self["webpackChunkblog_frontend"]=self["webpackChunkblog_frontend"]||[]).push([[928],{72928:(t,e,o)=>{o.r(e),o.d(e,{default:()=>u});o(52675),o(89463);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"photo-management"},[e("el-card",{attrs:{shadow:"hover"}},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("照片管理")]),e("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"small"},on:{click:t.handleAddPhoto}},[t._v("上传照片")])],1),e("el-form",{staticClass:"search-form",attrs:{inline:!0,model:t.searchForm}},[e("el-form-item",{attrs:{label:"相册分类"}},[e("el-select",{attrs:{placeholder:"选择相册分类",clearable:""},model:{value:t.searchForm.categoryId,callback:function(e){t.$set(t.searchForm,"categoryId",e)},expression:"searchForm.categoryId"}},t._l(t.categories,function(t){return e("el-option",{key:t.id,attrs:{label:t.categoryName,value:t.id}})}),1)],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.searchPhotos}},[t._v("查询")]),e("el-button",{on:{click:t.resetSearch}},[t._v("重置")])],1)],1),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"photo-list"},[0===t.photos.length?e("el-empty",{attrs:{description:"暂无照片"}}):e("div",{staticClass:"photo-grid"},t._l(t.photos,function(o,a){return e("div",{key:o.id,staticClass:"photo-item"},[e("el-card",{attrs:{"body-style":{padding:"0px"},shadow:"hover"}},[e("div",{staticClass:"photo-img-container"},[e("img",{staticClass:"photo-img",attrs:{src:o.url},on:{click:function(e){return t.previewPhoto(a)}}})]),e("div",{staticClass:"photo-info"},[e("div",{staticClass:"photo-title"},[t._v(t._s(o.description||"无描述"))]),e("div",{staticClass:"photo-category"},[t._v(t._s(t.getCategoryName(o.categoryId)))]),e("div",{staticClass:"photo-actions"},[e("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return t.handleEdit(o)}}},[t._v("编辑")]),e("el-button",{staticStyle:{color:"#F56C6C"},attrs:{type:"text",size:"mini"},on:{click:function(e){return t.handleDelete(o)}}},[t._v("删除")])],1)])])],1)}),0)],1),e("div",{staticClass:"pagination-container"},[e("el-pagination",{attrs:{"current-page":t.pagination.current,"page-sizes":[12,24,36,48],"page-size":t.pagination.size,layout:"total, sizes, prev, pager, next, jumper",total:t.pagination.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),e("el-dialog",{attrs:{title:t.dialogTitle,visible:t.dialogVisible,width:"500px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{ref:"photoForm",attrs:{model:t.photoForm,rules:t.photoRules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"相册分类",prop:"categoryId"}},[e("el-select",{attrs:{placeholder:"请选择相册分类"},model:{value:t.photoForm.categoryId,callback:function(e){t.$set(t.photoForm,"categoryId",e)},expression:"photoForm.categoryId"}},t._l(t.categories,function(t){return e("el-option",{key:t.id,attrs:{label:t.categoryName,value:t.id}})}),1)],1),e("el-form-item",{attrs:{label:"照片描述",prop:"description"}},[e("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入照片描述"},model:{value:t.photoForm.description,callback:function(e){t.$set(t.photoForm,"description",e)},expression:"photoForm.description"}})],1),t.photoForm.id?e("el-form-item",{attrs:{label:"照片"}},[e("img",{staticClass:"preview-img",attrs:{src:t.photoForm.url}})]):e("el-form-item",{attrs:{label:"照片",prop:"url"}},[e("el-upload",{staticClass:"upload-container",attrs:{action:"http://localhost:8080/api/upload/image",headers:t.uploadHeaders,"show-file-list":!1,"on-success":t.handleUploadSuccess,"before-upload":t.beforePhotoUpload}},[t.photoForm.url?e("img",{staticClass:"upload-img",attrs:{src:t.photoForm.url}}):e("i",{staticClass:"el-icon-plus upload-icon"}),t.photoForm.url?t._e():e("div",{staticClass:"upload-tip"},[t._v("点击上传照片")])])],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary",loading:t.submitLoading},on:{click:t.submitPhoto}},[t._v("确 定")])],1)],1),e("el-dialog",{attrs:{visible:t.previewVisible,"append-to-body":"",width:"800px"},on:{"update:visible":function(e){t.previewVisible=e}}},[e("img",{staticStyle:{width:"100%"},attrs:{src:t.previewUrl,alt:"Preview Image"}})])],1)},i=[],r=o(41034),s=(o(50113),o(64346),o(62062),o(62010),o(18111),o(20116),o(61701),o(26099),o(11392),o(50788)),n=o.n(s),l=o(93518);const c={name:"PhotoManagement",data:function(){return{searchForm:{categoryId:""},photos:[],categories:[],loading:!1,pagination:{current:1,size:12,total:0},dialogVisible:!1,dialogTitle:"上传照片",photoForm:{id:null,categoryId:"",description:"",url:""},photoRules:{categoryId:[{required:!0,message:"请选择相册分类",trigger:"change"}],url:[{required:!0,message:"请上传照片",trigger:"change"}]},submitLoading:!1,previewVisible:!1,previewUrl:""}},computed:(0,r.A)((0,r.A)({},(0,l.L8)(["token"])),{},{uploadHeaders:function(){return{Authorization:"Bearer ".concat(this.token)}}}),created:function(){this.fetchCategories(),this.fetchPhotos()},methods:{getFullImageUrl:function(t){return t?t.startsWith("http")?t:t.startsWith("/")?"http://localhost:8080".concat(t):"http://localhost:8080/uploads/".concat(t):""},fetchCategories:function(){var t=this;n().get("/api/photo/category/list",{headers:{Authorization:this.token}}).then(function(e){console.log("Categories response:",e.data);var o=e.data.data||e.data;t.categories=Array.isArray(o)?o.map(function(t){return(0,r.A)((0,r.A)({},t),{},{categoryName:t.categoryName||t.name})}):[]})["catch"](function(e){console.error("获取相册分类失败",e),t.$message.error("获取相册分类失败")})},fetchPhotos:function(){var t=this;this.loading=!0;var e=(0,r.A)({current:this.pagination.current,size:this.pagination.size},this.searchForm);n().get("/api/admin/photos",{params:e,headers:{Authorization:this.token}}).then(function(e){if(e.data&&e.data.data){var o=e.data.data.records||e.data.data;o=o.map(function(e){return(0,r.A)((0,r.A)({},e),{},{url:t.getFullImageUrl(e.url)})}),t.photos=o,t.pagination.total=e.data.data.total||0}})["catch"](function(e){console.error("获取照片列表失败",e),t.$message.error("获取照片列表失败")})["finally"](function(){t.loading=!1})},getCategoryName:function(t){var e=this.categories.find(function(e){return e.id===t});return e?e.categoryName||e.name:"未分类"},searchPhotos:function(){this.pagination.current=1,this.fetchPhotos()},resetSearch:function(){this.searchForm={categoryId:""},this.searchPhotos()},handleSizeChange:function(t){this.pagination.size=t,this.fetchPhotos()},handleCurrentChange:function(t){this.pagination.current=t,this.fetchPhotos()},handleAddPhoto:function(){var t=this;this.dialogTitle="上传照片",this.photoForm={id:null,categoryId:"",description:"",url:""},this.dialogVisible=!0,this.$nextTick(function(){t.$refs.photoForm&&t.$refs.photoForm.clearValidate()})},handleEdit:function(t){var e=this;this.dialogTitle="编辑照片",this.photoForm={id:t.id,categoryId:t.categoryId,description:t.description,url:t.url},this.dialogVisible=!0,this.$nextTick(function(){e.$refs.photoForm&&e.$refs.photoForm.clearValidate()})},handleDelete:function(t){var e=this;this.$confirm("确认删除该照片吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var o=localStorage.getItem("token");n()["delete"]("/api/admin/photos/".concat(t.id),{headers:{Authorization:o?"Bearer ".concat(o):""}}).then(function(){e.$message.success("删除成功"),e.fetchPhotos()})["catch"](function(t){console.error("删除照片失败",t),e.$message.error("删除照片失败")})})["catch"](function(){})},handleUploadSuccess:function(t){console.log("上传响应:",t),200===t.code?(this.photoForm.url=this.getFullImageUrl(t.message),this.$message.success("上传成功"),this.fetchPhotos()):this.$message.error("上传失败")},beforePhotoUpload:function(t){var e="image/jpeg"===t.type||"image/png"===t.type||"image/gif"===t.type,o=t.size/1024/1024<2;return e||this.$message.error("上传头像图片只能是 JPG/PNG/GIF 格式!"),o||this.$message.error("上传头像图片大小不能超过 2MB!"),e&&o},submitPhoto:function(){var t=this;this.$refs.photoForm.validate(function(e){if(e){t.submitLoading=!0;var o=t.photoForm.id?"put":"post",a=t.photoForm.id?"/api/admin/photos/".concat(t.photoForm.id):"/api/admin/photos";n()[o](a,t.photoForm,{headers:{Authorization:"Bearer ".concat(t.token)}}).then(function(){t.$message.success(t.photoForm.id?"更新成功":"添加成功"),t.dialogVisible=!1,t.pagination.current=1,t.fetchPhotos()})["catch"](function(e){console.error("提交照片失败",e),t.$message.error(t.photoForm.id?"更新照片失败":"添加照片失败")})["finally"](function(){t.submitLoading=!1})}})},previewPhoto:function(t){this.previewUrl=this.photos[t].url,this.previewVisible=!0}}},h=c;var d=o(81656),p=(0,d.A)(h,a,i,!1,null,"345a69de",null);const u=p.exports}}]);
//# sourceMappingURL=928.0f240d9c.js.map