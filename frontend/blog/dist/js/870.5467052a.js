"use strict";(self["webpackChunkblog_frontend"]=self["webpackChunkblog_frontend"]||[]).push([[870],{70870:(t,e,n)=>{n.r(e),n.d(e,{default:()=>g});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-review"},[e("el-card",{attrs:{shadow:"hover"}},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("文章审核")])]),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.articles}},[e("el-table-column",{attrs:{prop:"title",label:"标题","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(n){return[e("el-tooltip",{attrs:{content:n.row.title,placement:"top",disabled:n.row.title.length<30}},[e("span",[t._v(t._s(t._f("ellipsis")(n.row.title,30)))])])]}}])}),e("el-table-column",{attrs:{prop:"authorName",label:"作者",width:"120"}}),e("el-table-column",{attrs:{prop:"categoryName",label:"分类",width:"120"}}),e("el-table-column",{attrs:{prop:"commentCount",label:"评论数",width:"100"}}),e("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(n){return[e("el-tag",{attrs:{type:t.getStatusType(n.row.status)}},[t._v(" "+t._s(t.getStatusText(n.row.status))+" ")])]}}])}),e("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"180"}}),e("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:t._u([{key:"default",fn:function(n){return[e("el-button-group",[e("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.handlePreview(n.row)}}},[t._v("预览")]),2===n.row.status?e("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(e){return t.handleApprove(n.row)}}},[t._v("通过")]):t._e(),2===n.row.status?e("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.handleReject(n.row)}}},[t._v("拒绝")]):t._e()],1)]}}])})],1),e("div",{staticClass:"pagination-container"},[e("el-pagination",{attrs:{"current-page":t.pagination.current,"page-sizes":[10,20,30,50],"page-size":t.pagination.size,layout:"total, sizes, prev, pager, next, jumper",total:t.pagination.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),e("el-dialog",{attrs:{title:"文章预览",visible:t.previewVisible,width:"80%"},on:{"update:visible":function(e){t.previewVisible=e}}},[t.previewArticle?e("div",[e("h2",[t._v(t._s(t.previewArticle.title))]),e("div",{staticClass:"article-meta"},[e("span",[t._v("作者："+t._s(t.previewArticle.authorName))]),e("span",[t._v("创建时间："+t._s(t.previewArticle.createTime))])]),t.previewArticle.summary?e("div",{staticClass:"article-summary"},[e("h4",[t._v("摘要：")]),e("p",[t._v(t._s(t.previewArticle.summary))])]):t._e(),e("div",{staticClass:"article-content"},[e("h4",[t._v("内容：")]),e("div",{domProps:{innerHTML:t._s(t.previewArticle.content)}})])]):t._e()])],1)},r=[],i=n(20908),s=n(30388),c=n(41034),o=(n(51629),n(62062),n(34782),n(18111),n(7588),n(61701),n(26099),n(47764),n(23500),n(62953),n(50788)),l=n.n(o),u=n(93518);const d={name:"ArticleReview",data:function(){return{articles:[],loading:!1,pagination:{current:1,size:10,total:0},previewVisible:!1,previewArticle:null}},computed:(0,c.A)({},(0,u.L8)(["token"])),filters:{ellipsis:function(t,e){return t?t.length<=e?t:t.slice(0,e)+"...":""}},created:function(){this.fetchPendingArticles()},methods:{fetchPendingArticles:function(){var t=this;return(0,s.A)((0,i.A)().m(function e(){var n,a,r,s,c,o;return(0,i.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return t.loading=!0,n={current:t.pagination.current,size:t.pagination.size},e.p=1,e.n=2,l().get("/api/article/pending",{params:n,headers:{Authorization:t.token}});case 2:if(a=e.v,console.log("待审核文章响应:",a),r=[],s=0,a.data&&200===a.data.code?(r=a.data.data.records||[],s=a.data.data.total||0):200===a.code&&(r=a.data.records||[],s=a.data.total||0),!(r.length>0)){e.n=4;break}return e.n=3,t.addCommentCounts(r);case 3:c=e.v,t.articles=c,e.n=5;break;case 4:t.articles=r;case 5:t.pagination.total=s,e.n=7;break;case 6:e.p=6,o=e.v,console.error("获取待审核文章失败",o),t.$message.error("获取待审核文章失败");case 7:return e.p=7,t.loading=!1,e.f(7);case 8:return e.a(2)}},e,null,[[1,6,7,8]])}))()},addCommentCounts:function(t){var e=this;return(0,s.A)((0,i.A)().m(function n(){var a;return(0,i.A)().w(function(n){while(1)switch(n.n){case 0:return n.n=1,e.getBatchCommentCounts(t.map(function(t){return t.id}));case 1:return a=n.v,n.a(2,t.map(function(t){return(0,c.A)((0,c.A)({},t),{},{commentCount:a[t.id]||0})}))}},n)}))()},getBatchCommentCounts:function(t){var e=this;return(0,s.A)((0,i.A)().m(function n(){var a,r,c,o,u,d;return(0,i.A)().w(function(n){while(1)switch(n.n){case 0:a={},r=5,c=0;case 1:if(!(c<t.length)){n.n=4;break}return o=t.slice(c,c+r),u=o.map(function(){var t=(0,s.A)((0,i.A)().m(function t(n){var a,r,s;return(0,i.A)().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,t.n=1,l().get("/api/comment/list",{params:{articleId:n,current:1,size:1},headers:{Authorization:e.token}});case 1:return a=t.v,r=0,a.data&&200===a.data.code?r=a.data.data.total||0:200===a.code&&(r=a.data.total||0),t.a(2,{articleId:n,total:r});case 2:return t.p=2,s=t.v,console.error("获取文章".concat(n,"的评论数失败:"),s),t.a(2,{articleId:n,total:0})}},t,null,[[0,2]])}));return function(e){return t.apply(this,arguments)}}()),n.n=2,Promise.all(u);case 2:d=n.v,d.forEach(function(t){var e=t.articleId,n=t.total;a[e]=n});case 3:c+=r,n.n=1;break;case 4:return n.a(2,a)}},n)}))()},handleSizeChange:function(t){this.pagination.size=t,this.fetchPendingArticles()},handleCurrentChange:function(t){this.pagination.current=t,this.fetchPendingArticles()},handlePreview:function(t){this.previewArticle=t,this.previewVisible=!0},handleApprove:function(t){var e=this;this.$confirm("确认通过该文章的审核吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){l().put("/api/article/approve/".concat(t.id),{},{headers:{Authorization:e.token}}).then(function(t){t.data&&200===t.data.code||200===t.code?(e.$message.success("审核通过"),e.fetchPendingArticles()):e.$message.error(t.message||"审核失败")})["catch"](function(t){console.error("审核通过失败",t),e.$message.error("审核通过失败")})})["catch"](function(){})},handleReject:function(t){var e=this;this.$confirm("确认拒绝该文章的审核吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){l().put("/api/article/reject/".concat(t.id),{},{headers:{Authorization:e.token}}).then(function(t){t.data&&200===t.data.code||200===t.code?(e.$message.success("审核拒绝"),e.fetchPendingArticles()):e.$message.error(t.message||"审核失败")})["catch"](function(t){console.error("审核拒绝失败",t),e.$message.error("审核拒绝失败")})})["catch"](function(){})},getStatusType:function(t){switch(t){case 1:return"success";case 2:return"warning";case 3:return"danger";default:return"info"}},getStatusText:function(t){switch(t){case 0:return"草稿";case 1:return"已发布";case 2:return"待审核";case 3:return"审核不通过";default:return"未知"}}}},p=d;var h=n(81656),f=(0,h.A)(p,a,r,!1,null,"0bf19c64",null);const g=f.exports}}]);
//# sourceMappingURL=870.5467052a.js.map