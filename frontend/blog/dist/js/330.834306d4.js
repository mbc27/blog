"use strict";(self["webpackChunkblog_frontend"]=self["webpackChunkblog_frontend"]||[]).push([[330],{19330:(e,t,s)=>{s.r(t),s.d(t,{default:()=>d});s(25276);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"message-management"},[t("el-card",{attrs:{shadow:"hover"}},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("留言管理")]),t("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.refreshMessages}},[e._v(" 刷新 ")])],1),t("div",{staticClass:"search-bar"},[t("el-input",{staticStyle:{width:"300px","margin-right":"10px"},attrs:{placeholder:"搜索留言内容、昵称或邮箱",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchMessages.apply(null,arguments)}},model:{value:e.searchKeyword,callback:function(t){e.searchKeyword=t},expression:"searchKeyword"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.searchMessages},slot:"append"})],1),t("el-button",{attrs:{type:"danger",disabled:0===e.selectedMessages.length},on:{click:e.batchDeleteMessages}},[e._v(" 批量删除 ("+e._s(e.selectedMessages.length)+") ")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.messages},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),t("el-table-column",{attrs:{prop:"nickname",label:"昵称",width:"120"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{size:"small"}},[e._v(e._s(s.row.nickname))])]}}])}),t("el-table-column",{attrs:{prop:"email",label:"邮箱",width:"180"}}),t("el-table-column",{attrs:{prop:"content",label:"留言内容","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",{staticClass:"message-content"},[e._v(" "+e._s(s.row.content)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"ip",label:"IP地址",width:"120"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:"info",size:"mini"}},[e._v(e._s(s.row.ip))])]}}])}),t("el-table-column",{attrs:{prop:"level",label:"层级",width:"80"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:1===s.row.level?"primary":"success",size:"mini"}},[e._v(" "+e._s(1===s.row.level?"主留言":"回复")+" ")])]}}])}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDate(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"200",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button-group",[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.viewMessage(s.row)}}},[e._v(" 查看 ")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.editMessage(s.row)}}},[e._v(" 编辑 ")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deleteMessage(s.row.id)}}},[e._v(" 删除 ")])],1)]}}])})],1),t("el-pagination",{staticStyle:{"margin-top":"20px","text-align":"center"},attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:"留言详情",visible:e.viewDialogVisible,width:"60%"},on:{"update:visible":function(t){e.viewDialogVisible=t}}},[e.currentMessage?t("div",[t("el-descriptions",{attrs:{column:2,border:""}},[t("el-descriptions-item",{attrs:{label:"ID"}},[e._v(e._s(e.currentMessage.id))]),t("el-descriptions-item",{attrs:{label:"昵称"}},[e._v(e._s(e.currentMessage.nickname))]),t("el-descriptions-item",{attrs:{label:"邮箱"}},[e._v(e._s(e.currentMessage.email))]),t("el-descriptions-item",{attrs:{label:"IP地址"}},[e._v(e._s(e.currentMessage.ip))]),t("el-descriptions-item",{attrs:{label:"层级"}},[e._v(" "+e._s(1===e.currentMessage.level?"主留言":"回复")+" ")]),t("el-descriptions-item",{attrs:{label:"父留言ID"}},[e._v(" "+e._s(e.currentMessage.parentId||"无")+" ")]),t("el-descriptions-item",{attrs:{label:"创建时间",span:2}},[e._v(" "+e._s(e.formatDate(e.currentMessage.createTime))+" ")]),t("el-descriptions-item",{attrs:{label:"留言内容",span:2}},[t("div",{staticClass:"message-content-detail"},[e._v(e._s(e.currentMessage.content))])])],1)],1):e._e()]),t("el-dialog",{attrs:{title:"编辑留言",visible:e.editDialogVisible,width:"50%"},on:{"update:visible":function(t){e.editDialogVisible=t}}},[t("el-form",{attrs:{model:e.editForm,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"昵称"}},[t("el-input",{model:{value:e.editForm.nickname,callback:function(t){e.$set(e.editForm,"nickname",t)},expression:"editForm.nickname"}})],1),t("el-form-item",{attrs:{label:"邮箱"}},[t("el-input",{model:{value:e.editForm.email,callback:function(t){e.$set(e.editForm,"email",t)},expression:"editForm.email"}})],1),t("el-form-item",{attrs:{label:"留言内容"}},[t("el-input",{attrs:{type:"textarea",rows:4},model:{value:e.editForm.content,callback:function(t){e.$set(e.editForm,"content",t)},expression:"editForm.content"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.updateMessage}},[e._v("确 定")])],1)],1)],1)},n=[],r=s(20908),i=s(30388),l=(s(62062),s(23288),s(18111),s(61701),s(26099),s(31552));const o={name:"MessageManagement",data:function(){return{messages:[],loading:!1,currentPage:1,pageSize:10,total:0,searchKeyword:"",selectedMessages:[],viewDialogVisible:!1,editDialogVisible:!1,currentMessage:null,editForm:{id:null,nickname:"",email:"",content:""}}},mounted:function(){this.fetchMessages()},methods:{fetchMessages:function(){var e=this;return(0,i.A)((0,r.A)().m(function t(){var s,a;return(0,r.A)().w(function(t){while(1)switch(t.p=t.n){case 0:return e.loading=!0,t.p=1,t.n=2,l.A.message.getAdminList({current:e.currentPage,size:e.pageSize});case 2:s=t.v,console.log("留言列表响应:",s),200===s.code?(e.messages=s.data.records,e.total=s.data.total):e.$message.error(s.message||"获取留言列表失败"),t.n=4;break;case 3:t.p=3,a=t.v,e.$message.error("获取留言列表失败"),console.error("Error fetching messages:",a);case 4:return t.p=4,e.loading=!1,t.f(4);case 5:return t.a(2)}},t,null,[[1,3,4,5]])}))()},refreshMessages:function(){this.currentPage=1,this.fetchMessages()},searchMessages:function(){var e=this;return(0,i.A)((0,r.A)().m(function t(){var s,a;return(0,r.A)().w(function(t){while(1)switch(t.p=t.n){case 0:return e.loading=!0,t.p=1,t.n=2,l.A.message.getAdminList({current:1,size:e.pageSize,keyword:e.searchKeyword});case 2:s=t.v,console.log("搜索留言响应:",s),200===s.code?(e.messages=s.data.records,e.total=s.data.total,e.currentPage=1):e.$message.error(s.message||"搜索失败"),t.n=4;break;case 3:t.p=3,a=t.v,e.$message.error("搜索失败"),console.error("Error searching messages:",a);case 4:return t.p=4,e.loading=!1,t.f(4);case 5:return t.a(2)}},t,null,[[1,3,4,5]])}))()},handleSelectionChange:function(e){this.selectedMessages=e},handleSizeChange:function(e){this.pageSize=e,this.currentPage=1,this.fetchMessages()},handleCurrentChange:function(e){this.currentPage=e,this.fetchMessages()},viewMessage:function(e){this.currentMessage=e,this.viewDialogVisible=!0},editMessage:function(e){this.editForm={id:e.id,nickname:e.nickname,email:e.email,content:e.content},this.editDialogVisible=!0},updateMessage:function(){var e=this;return(0,i.A)((0,r.A)().m(function t(){var s,a;return(0,r.A)().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,t.n=1,l.A.message.update(e.editForm.id,e.editForm);case 1:s=t.v,200===s.code?(e.$message.success("更新成功"),e.editDialogVisible=!1,e.fetchMessages()):e.$message.error(s.message||"更新失败"),t.n=3;break;case 2:t.p=2,a=t.v,e.$message.error("更新失败"),console.error("Error updating message:",a);case 3:return t.a(2)}},t,null,[[0,2]])}))()},deleteMessage:function(e){var t=this;this.$confirm("此操作将永久删除该留言及其所有回复, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((0,i.A)((0,r.A)().m(function s(){var a,n;return(0,r.A)().w(function(s){while(1)switch(s.p=s.n){case 0:return s.p=0,s.n=1,l.A.message["delete"](e);case 1:a=s.v,200===a.code?(t.$message.success("删除成功"),t.fetchMessages()):t.$message.error(a.message||"删除失败"),s.n=3;break;case 2:s.p=2,n=s.v,t.$message.error("删除失败"),console.error("Error deleting message:",n);case 3:return s.a(2)}},s,null,[[0,2]])})))},batchDeleteMessages:function(){var e=this;0!==this.selectedMessages.length?this.$confirm("此操作将永久删除选中的 ".concat(this.selectedMessages.length," 条留言, 是否继续?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((0,i.A)((0,r.A)().m(function t(){var s,a,n;return(0,r.A)().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,s=e.selectedMessages.map(function(e){return e.id}),t.n=1,l.A.message.batchDelete(s);case 1:a=t.v,200===a.code?(e.$message.success("批量删除成功"),e.fetchMessages()):e.$message.error(a.message||"批量删除失败"),t.n=3;break;case 2:t.p=2,n=t.v,e.$message.error("批量删除失败"),console.error("Error batch deleting messages:",n);case 3:return t.a(2)}},t,null,[[0,2]])}))):this.$message.warning("请选择要删除的留言")},formatDate:function(e){if(!e)return"";var t=new Date(e);return t.toLocaleString("zh-CN")}}},c=o;var u=s(81656),g=(0,u.A)(c,a,n,!1,null,"c46206bc",null);const d=g.exports}}]);
//# sourceMappingURL=330.834306d4.js.map