"use strict";(self["webpackChunkblog_frontend"]=self["webpackChunkblog_frontend"]||[]).push([[677],{6562:(e,t,a)=>{function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}a.d(t,{A:()=>r})},12635:(e,t,a)=>{a.d(t,{A:()=>o});a(76918),a(23418),a(34782),a(23288),a(62010),a(26099),a(27495),a(90906),a(38781),a(47764);var r=a(6562);function o(e,t){if(e){if("string"==typeof e)return(0,r.A)(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?(0,r.A)(e,t):void 0}}},23418:(e,t,a)=>{var r=a(46518),o=a(97916),i=a(84428),s=!i(function(e){Array.from(e)});r({target:"Array",stat:!0,forced:s},{from:o})},37677:(e,t,a)=>{a.r(t),a.d(t,{default:()=>p});a(62010);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"article-management"},[t("el-card",{attrs:{shadow:"hover"}},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("文章管理")]),t("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"small"},on:{click:e.handleAddArticle}},[e._v("新增文章")])],1),t("el-form",{staticClass:"search-form",attrs:{inline:!0,model:e.searchForm}},[t("el-form-item",{attrs:{label:"标题"}},[t("el-input",{attrs:{placeholder:"文章标题",clearable:""},model:{value:e.searchForm.title,callback:function(t){e.$set(e.searchForm,"title",t)},expression:"searchForm.title"}})],1),t("el-form-item",{attrs:{label:"分类"}},[t("el-select",{attrs:{placeholder:"选择分类",clearable:""},model:{value:e.searchForm.categoryId,callback:function(t){e.$set(e.searchForm,"categoryId",t)},expression:"searchForm.categoryId"}},e._l(e.categories,function(e){return t("el-option",{key:e.id,attrs:{label:e.categoryName||e.name,value:e.id}})}),1)],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{attrs:{placeholder:"文章状态",clearable:""},model:{value:e.searchForm.status,callback:function(t){e.$set(e.searchForm,"status",t)},expression:"searchForm.status"}},[t("el-option",{attrs:{label:"已发布",value:1}}),t("el-option",{attrs:{label:"草稿",value:0}})],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.searchArticles}},[e._v("查询")]),t("el-button",{on:{click:e.resetSearch}},[e._v("重置")])],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.articles}},[t("el-table-column",{attrs:{prop:"title",label:"标题","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tooltip",{attrs:{content:a.row.title,placement:"top",disabled:a.row.title.length<30}},[t("span",[e._v(e._s(e._f("ellipsis")(a.row.title,30)))])])]}}])}),t("el-table-column",{attrs:{prop:"categoryName",label:"分类",width:"120"}}),t("el-table-column",{attrs:{prop:"viewCount",label:"浏览量",width:"100"}}),t("el-table-column",{attrs:{prop:"commentCount",label:"评论数",width:"100"}}),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:1===a.row.status?"success":"info"}},[e._v(" "+e._s(1===a.row.status?"已发布":"草稿")+" ")])]}}])}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"180"}}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleEdit(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(a.row)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"pagination-container"},[t("el-pagination",{attrs:{"current-page":e.pagination.current,"page-sizes":[10,20,30,50],"page-size":e.pagination.size,layout:"total, sizes, prev, pager, next, jumper",total:e.pagination.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"80%","before-close":e.handleDialogClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"articleForm",attrs:{model:e.articleForm,rules:e.articleRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[t("el-input",{attrs:{placeholder:"请输入文章标题"},model:{value:e.articleForm.title,callback:function(t){e.$set(e.articleForm,"title",t)},expression:"articleForm.title"}})],1),t("el-form-item",{attrs:{label:"文章分类",prop:"categoryId"}},[t("el-select",{attrs:{placeholder:"请选择文章分类"},model:{value:e.articleForm.categoryId,callback:function(t){e.$set(e.articleForm,"categoryId",t)},expression:"articleForm.categoryId"}},e._l(e.categories,function(e){return t("el-option",{key:e.id,attrs:{label:e.categoryName||e.name,value:e.id}})}),1)],1),t("el-form-item",{attrs:{label:"文章摘要",prop:"summary"}},[t("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入文章摘要"},model:{value:e.articleForm.summary,callback:function(t){e.$set(e.articleForm,"summary",t)},expression:"articleForm.summary"}})],1),t("el-form-item",{attrs:{label:"文章内容",prop:"content"}},[t("div",{staticClass:"editor-container"},[t("el-input",{attrs:{type:"textarea",rows:15,placeholder:"请输入文章内容（支持Markdown格式）"},model:{value:e.articleForm.content,callback:function(t){e.$set(e.articleForm,"content",t)},expression:"articleForm.content"}})],1)]),t("el-form-item",{attrs:{label:"文章封面"}},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/api/upload",headers:e.uploadHeaders,"show-file-list":!1,"on-success":e.handleCoverSuccess,"before-upload":e.beforeCoverUpload}},[e.articleForm.cover?t("img",{staticClass:"avatar",attrs:{src:e.articleForm.cover}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),t("el-form-item",{attrs:{label:"是否置顶"}},[t("el-switch",{model:{value:e.articleForm.isTop,callback:function(t){e.$set(e.articleForm,"isTop",t)},expression:"articleForm.isTop"}})],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-radio-group",{model:{value:e.articleForm.status,callback:function(t){e.$set(e.articleForm,"status",t)},expression:"articleForm.status"}},[t("el-radio",{attrs:{label:1}},[e._v("发布")]),t("el-radio",{attrs:{label:0}},[e._v("草稿")])],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.submitArticle}},[e._v("确 定")])],1)],1)],1)},o=[],i=a(20908),s=a(59258),n=a(30388),l=a(41034),c=(a(28706),a(2008),a(51629),a(74423),a(62062),a(34782),a(18111),a(22489),a(7588),a(61701),a(26099),a(21699),a(47764),a(11392),a(23500),a(62953),a(76031),a(50788)),u=a.n(c),d=a(93518);const m={name:"ArticleManagement",data:function(){return{searchForm:{title:"",categoryId:"",status:""},articles:[],categories:[],tags:[],loading:!1,pagination:{current:1,size:10,total:0},dialogVisible:!1,dialogTitle:"新增文章",articleForm:{id:null,title:"",categoryId:"",tagIds:[],summary:"",content:"",cover:"",isTop:!1,isRecommend:!1,status:1},articleRules:{title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{max:100,message:"长度不能超过100个字符",trigger:"blur"}],categoryId:[{required:!0,message:"请选择文章分类",trigger:"change"}],content:[{required:!0,message:"请输入文章内容",trigger:"blur"}]},submitLoading:!1}},computed:(0,l.A)((0,l.A)({},(0,d.L8)(["token"])),{},{uploadHeaders:function(){return{Authorization:this.token}}}),filters:{ellipsis:function(e,t){return e?e.length<=t?e:e.slice(0,t)+"...":""}},created:function(){this.fetchCategories(),this.fetchTags(),this.fetchArticles()},methods:{fetchCategories:function(){var e=this;u().get("/api/category/list",{headers:{Authorization:this.token}}).then(function(t){console.log("分类列表响应:",t),t.data&&200===t.data.code?e.categories=t.data.data||[]:200===t.code&&(e.categories=t.data||[])})["catch"](function(t){console.error("获取分类列表失败",t),e.$message.error("获取分类列表失败")})},fetchTags:function(){this.tags=[]},fetchArticles:function(){var e=this;return(0,n.A)((0,i.A)().m(function t(){var a,r,o,n,l,c,u,d;return(0,i.A)().w(function(t){while(1)switch(t.p=t.n){case 0:return e.loading=!0,t.p=1,t.n=2,e.fetchPublishedArticles();case 2:return a=t.v,t.n=3,e.fetchPendingArticles();case 3:return r=t.v,o=[].concat((0,s.A)(a),(0,s.A)(r)),t.n=4,e.addCategoryNames(o);case 4:n=t.v,l=n,e.searchForm.title&&(l=n.filter(function(t){return t.title&&t.title.includes(e.searchForm.title)})),e.searchForm.categoryId&&(l=l.filter(function(t){return t.categoryId===e.searchForm.categoryId})),""!==e.searchForm.status&&(l=l.filter(function(t){return t.status===e.searchForm.status})),c=(e.pagination.current-1)*e.pagination.size,u=c+e.pagination.size,e.articles=l.slice(c,u),e.pagination.total=l.length,t.n=6;break;case 5:t.p=5,d=t.v,console.error("获取文章列表失败",d),e.$message.error("获取文章列表失败");case 6:return t.p=6,e.loading=!1,t.f(6);case 7:return t.a(2)}},t,null,[[1,5,6,7]])}))()},addCategoryNames:function(e){var t=this;return(0,n.A)((0,i.A)().m(function a(){var r,o;return(0,i.A)().w(function(a){while(1)switch(a.n){case 0:return r={},t.categories.forEach(function(e){r[e.id]=e.categoryName||e.name}),a.n=1,t.getBatchCommentCounts(e.map(function(e){return e.id}));case 1:return o=a.v,a.a(2,e.map(function(e){return(0,l.A)((0,l.A)({},e),{},{categoryName:r[e.categoryId]||"未分类",commentCount:o[e.id]||0})}))}},a)}))()},getBatchCommentCounts:function(e){var t=this;return(0,n.A)((0,i.A)().m(function a(){var r,o,s,l,c,d;return(0,i.A)().w(function(a){while(1)switch(a.n){case 0:r={},o=5,s=0;case 1:if(!(s<e.length)){a.n=4;break}return l=e.slice(s,s+o),c=l.map(function(){var e=(0,n.A)((0,i.A)().m(function e(a){var r,o,s;return(0,i.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,e.n=1,u().get("/api/comment/list",{params:{articleId:a,current:1,size:1},headers:{Authorization:t.token}});case 1:return r=e.v,o=0,r.data&&200===r.data.code?o=r.data.data.total||0:200===r.code&&(o=r.data.total||0),e.a(2,{articleId:a,total:o});case 2:return e.p=2,s=e.v,console.error("获取文章".concat(a,"的评论数失败:"),s),e.a(2,{articleId:a,total:0})}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}()),a.n=2,Promise.all(c);case 2:d=a.v,d.forEach(function(e){var t=e.articleId,a=e.total;r[t]=a});case 3:s+=o,a.n=1;break;case 4:return a.a(2,r)}},a)}))()},fetchPublishedArticles:function(){var e=this;return(0,n.A)((0,i.A)().m(function t(){var a,r;return(0,i.A)().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,t.n=1,u().get("/api/article/list",{params:{current:1,size:1e3},headers:{Authorization:e.token}});case 1:if(a=t.v,console.log("已发布文章响应:",a),!a.data||200!==a.data.code){t.n=2;break}return t.a(2,a.data.data.records||[]);case 2:if(200!==a.code){t.n=3;break}return t.a(2,a.data.records||[]);case 3:return t.a(2,[]);case 4:return t.p=4,r=t.v,console.error("获取已发布文章失败",r),t.a(2,[])}},t,null,[[0,4]])}))()},fetchPendingArticles:function(){var e=this;return(0,n.A)((0,i.A)().m(function t(){var a,r;return(0,i.A)().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,t.n=1,u().get("/api/article/pending",{params:{current:1,size:1e3},headers:{Authorization:e.token}});case 1:if(a=t.v,console.log("待审核文章响应:",a),!a.data||200!==a.data.code){t.n=2;break}return t.a(2,a.data.data.records||[]);case 2:if(200!==a.code){t.n=3;break}return t.a(2,a.data.records||[]);case 3:return t.a(2,[]);case 4:return t.p=4,r=t.v,console.error("获取待审核文章失败",r),t.a(2,[])}},t,null,[[0,4]])}))()},searchArticles:function(){this.pagination.current=1,this.fetchArticles()},resetSearch:function(){this.searchForm={title:"",categoryId:"",status:""},this.searchArticles()},handleSizeChange:function(e){this.pagination.size=e,this.fetchArticles()},handleCurrentChange:function(e){this.pagination.current=e,this.fetchArticles()},handleAddArticle:function(){var e=this;this.dialogTitle="新增文章",this.articleForm={id:null,title:"",categoryId:"",tagIds:[],summary:"",content:"",cover:"",isTop:!1,status:1,userId:null},this.dialogVisible=!0,this.$nextTick(function(){e.$refs.articleForm&&e.$refs.articleForm.clearValidate()})},handleEdit:function(e){var t=this;this.dialogTitle="编辑文章",this.loading=!0,u().get("/api/article/".concat(e.id),{headers:{Authorization:this.token}}).then(function(e){var a;console.log("文章详情响应:",e),e.data&&200===e.data.code?a=e.data.data:200===e.code&&(a=e.data),a&&(t.articleForm={id:a.id,title:a.title,categoryId:a.categoryId,tagIds:[],summary:a.summary,content:a.content,cover:a.cover,isTop:1===a.isTop,status:a.status,userId:a.userId},t.dialogVisible=!0,t.$nextTick(function(){t.$refs.articleForm&&t.$refs.articleForm.clearValidate()}))})["catch"](function(e){console.error("获取文章详情失败",e),t.$message.error("获取文章详情失败")})["finally"](function(){t.loading=!1})},handleDelete:function(e){var t=this;this.$confirm("确认删除该文章吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){u()["delete"]("/api/article/".concat(e.id),{headers:{Authorization:t.token}}).then(function(e){if(console.log("删除文章响应:",e),e.data&&200===e.data.code)t.$message.success("删除成功"),t.fetchArticles();else if(200===e.code||200===e.status)t.$message.success("删除成功"),t.fetchArticles();else{var a=e.data&&e.data.message||e.message||"删除文章失败";t.$message.error(a)}})["catch"](function(e){if(console.error("删除文章失败",e),e.response&&200===e.response.status)t.$message.success("删除成功"),t.fetchArticles();else{var a="删除文章失败";e.response&&e.response.data&&e.response.data.message?a=e.response.data.message:e.message&&(a=e.message),t.$message.error(a),setTimeout(function(){t.fetchArticles()},1e3)}})})["catch"](function(){})},submitArticle:function(){var e=this;this.$refs.articleForm.validate(function(t){if(!t)return!1;e.submitLoading=!0;var a,r=(0,l.A)((0,l.A)({},e.articleForm),{},{isTop:e.articleForm.isTop?1:0});delete r.tagIds,a=e.articleForm.id?u().put("/api/article/".concat(e.articleForm.id),r,{headers:{Authorization:e.token}}):u().post("/api/article",r,{headers:{Authorization:e.token}}),a.then(function(t){if(console.log("文章提交响应:",t),t.data&&200===t.data.code)e.$message.success("".concat(e.articleForm.id?"更新":"添加","文章成功")),e.dialogVisible=!1,e.fetchArticles();else if(200===t.code)e.$message.success("".concat(e.articleForm.id?"更新":"添加","文章成功")),e.dialogVisible=!1,e.fetchArticles();else{var a=t.data&&t.data.message||t.message||"".concat(e.articleForm.id?"更新":"添加","文章失败");e.$message.error(a)}})["catch"](function(t){console.error("".concat(e.articleForm.id?"更新":"添加","文章失败"),t);var a="".concat(e.articleForm.id?"更新":"添加","文章失败");t.response&&t.response.data&&t.response.data.message?a=t.response.data.message:t.message&&(a=t.message),e.$message.error(a)})["finally"](function(){e.submitLoading=!1})})},handleDialogClose:function(e){this.submitLoading?this.$message.warning("正在提交，请稍候..."):e()},handleCoverSuccess:function(e){this.articleForm.cover=e.data,this.$message.success("封面上传成功")},beforeCoverUpload:function(e){var t=e.type.startsWith("image/"),a=e.size/1024/1024<2;return t||this.$message.error("上传封面只能是图片格式!"),a||this.$message.error("上传封面大小不能超过 2MB!"),t&&a}}},h=m;var f=a(81656),g=(0,f.A)(h,r,o,!1,null,"b809821c",null);const p=g.exports},59258:(e,t,a)=>{a.d(t,{A:()=>l});a(64346);var r=a(6562);function o(e){if(Array.isArray(e))return(0,r.A)(e)}a(52675),a(89463),a(2259),a(23418),a(26099),a(47764),a(62953);function i(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var s=a(12635);a(16280),a(76918);function n(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e){return o(e)||i(e)||(0,s.A)(e)||n()}}}]);
//# sourceMappingURL=677.bdfacd25.js.map