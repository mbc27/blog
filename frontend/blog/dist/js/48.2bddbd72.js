"use strict";(self["webpackChunkblog_frontend"]=self["webpackChunkblog_frontend"]||[]).push([[48],{25048:(e,t,a)=>{a.r(t),a.d(t,{default:()=>d});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"message-page"},[t("div",{staticClass:"container"},[t("h1",[e._v("留言板")]),t("div",{staticClass:"message-form"},[t("h2",[e._v("发表留言")]),t("el-form",{ref:"messageForm",attrs:{model:e.messageForm,rules:e.currentRules}},[e.isAuthenticated?t("el-form-item",[t("el-input",{attrs:{placeholder:"昵称",disabled:!0},model:{value:e.messageForm.nickname,callback:function(t){e.$set(e.messageForm,"nickname",t)},expression:"messageForm.nickname"}},[t("template",{slot:"prepend"},[e._v("登录用户")])],2)],1):t("el-form-item",{attrs:{prop:"nickname"}},[t("el-input",{attrs:{placeholder:"昵称"},model:{value:e.messageForm.nickname,callback:function(t){e.$set(e.messageForm,"nickname",t)},expression:"messageForm.nickname"}})],1),e.isAuthenticated?t("el-form-item",[t("el-input",{attrs:{placeholder:"邮箱（不会公开）",disabled:!0},model:{value:e.messageForm.email,callback:function(t){e.$set(e.messageForm,"email",t)},expression:"messageForm.email"}},[t("template",{slot:"prepend"},[e._v("邮箱")])],2)],1):t("el-form-item",{attrs:{prop:"email"}},[t("el-input",{attrs:{placeholder:"邮箱（不会公开）"},model:{value:e.messageForm.email,callback:function(t){e.$set(e.messageForm,"email",t)},expression:"messageForm.email"}})],1),t("el-form-item",{attrs:{prop:"content"}},[t("el-input",{attrs:{type:"textarea",rows:"4",placeholder:"留言内容"},model:{value:e.messageForm.content,callback:function(t){e.$set(e.messageForm,"content",t)},expression:"messageForm.content"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.submitMessage}},[e._v("提交留言")])],1)],1)],1),e.loading?t("el-skeleton",{attrs:{loading:e.loading,animated:"",count:3}},[t("template",{slot:"template"},[t("div",{staticClass:"message-list"},e._l(3,function(e){return t("div",{key:e,staticClass:"message-item"},[t("div",{staticClass:"message-avatar"},[t("el-skeleton-item",{staticStyle:{width:"50px",height:"50px"},attrs:{variant:"circle"}})],1),t("div",{staticClass:"message-content"},[t("div",{staticClass:"message-header"},[t("el-skeleton-item",{staticStyle:{width:"30%"},attrs:{variant:"text"}}),t("el-skeleton-item",{staticStyle:{width:"20%"},attrs:{variant:"text"}})],1),t("el-skeleton-item",{staticStyle:{width:"100%"},attrs:{variant:"p"}}),t("el-skeleton-item",{staticStyle:{width:"100%"},attrs:{variant:"p"}})],1)])}),0)])],2):[e.messages.length>0?t("div",{staticClass:"message-list"},e._l(e.messages,function(a){return t("div",{key:a.id,staticClass:"message-item"},[t("div",{staticClass:"message-avatar"},[t("img",{attrs:{src:a.avatar,alt:a.nickname}})]),t("div",{staticClass:"message-content"},[t("div",{staticClass:"message-header"},[t("span",{staticClass:"message-nickname"},[e._v(e._s(a.nickname))]),t("span",{staticClass:"message-time"},[e._v(e._s(a.time))])]),t("div",{staticClass:"message-text"},[e._v(e._s(a.content))]),t("div",{staticClass:"message-actions"},[t("span",{staticClass:"message-like"},[t("i",{staticClass:"el-icon-thumb"}),e._v(" "+e._s(a.likes||0)+" ")]),t("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-chat-dot-round"},on:{click:function(t){return e.toggleReplyInput(a.id)}}},[e._v(" 回复 ("+e._s(a.replies?a.replies.length:0)+") ")])],1),e.replyingTo===a.id?t("div",{staticClass:"reply-input-section"},[t("el-form",{ref:"replyForm",refInFor:!0,attrs:{model:e.replyForm,rules:e.replyRules}},[e.isAuthenticated?t("el-form-item",[t("el-input",{attrs:{placeholder:"昵称",disabled:!0},model:{value:e.replyForm.nickname,callback:function(t){e.$set(e.replyForm,"nickname",t)},expression:"replyForm.nickname"}},[t("template",{slot:"prepend"},[e._v("登录用户")])],2)],1):t("el-form-item",{attrs:{prop:"nickname"}},[t("el-input",{attrs:{placeholder:"昵称"},model:{value:e.replyForm.nickname,callback:function(t){e.$set(e.replyForm,"nickname",t)},expression:"replyForm.nickname"}})],1),e.isAuthenticated?t("el-form-item",[t("el-input",{attrs:{placeholder:"邮箱（不会公开）",disabled:!0},model:{value:e.replyForm.email,callback:function(t){e.$set(e.replyForm,"email",t)},expression:"replyForm.email"}},[t("template",{slot:"prepend"},[e._v("邮箱")])],2)],1):t("el-form-item",{attrs:{prop:"email"}},[t("el-input",{attrs:{placeholder:"邮箱（不会公开）"},model:{value:e.replyForm.email,callback:function(t){e.$set(e.replyForm,"email",t)},expression:"replyForm.email"}})],1),t("el-form-item",{attrs:{prop:"content"}},[t("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"回复 @".concat(a.nickname)},model:{value:e.replyForm.content,callback:function(t){e.$set(e.replyForm,"content",t)},expression:"replyForm.content"}})],1),t("el-form-item",[t("el-button",{attrs:{size:"small"},on:{click:e.cancelReply}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",size:"small",loading:e.replySubmitting},on:{click:function(t){return e.submitReply(a)}}},[e._v(" 提交回复 ")])],1)],1)],1):e._e(),a.replies&&a.replies.length>0?t("div",{staticClass:"reply-list"},e._l(a.replies,function(a){return t("div",{key:a.id,staticClass:"reply-item"},[t("div",{staticClass:"reply-avatar"},[t("img",{attrs:{src:a.avatar,alt:a.nickname}})]),t("div",{staticClass:"reply-content"},[t("div",{staticClass:"reply-header"},[t("span",{staticClass:"reply-nickname"},[e._v(e._s(a.nickname))]),t("span",{staticClass:"reply-time"},[e._v(e._s(a.time))])]),t("div",{staticClass:"reply-text"},[e._v(e._s(a.content))])])])}),0):e._e()])])}),0):t("el-empty",{attrs:{description:"暂无留言"}}),e.total>e.pageSize?t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":e.currentPage,"page-size":e.pageSize,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"current-change":e.handlePageChange}})],1):e._e()]],2)])},r=[],n=a(20908),i=a(30388),l=a(41034),c=(a(28706),a(2008),a(64346),a(62062),a(23288),a(18111),a(22489),a(61701),a(26099),a(68156),a(42762),a(31552)),m=a(93518);const o={name:"Message",data:function(){return{messageForm:{nickname:"",email:"",content:""},replyForm:{nickname:"",email:"",content:""},rules:{content:[{required:!0,message:"请输入留言内容",trigger:"blur"},{min:5,max:500,message:"长度在 5 到 500 个字符",trigger:"blur"}]},guestRules:{nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],content:[{required:!0,message:"请输入留言内容",trigger:"blur"},{min:5,max:500,message:"长度在 5 到 500 个字符",trigger:"blur"}]},replyRules:{nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],content:[{required:!0,message:"请输入回复内容",trigger:"blur"},{min:5,max:500,message:"长度在 5 到 500 个字符",trigger:"blur"}]},messages:[],total:0,currentPage:1,pageSize:10,loading:!1,replyingTo:null,replySubmitting:!1}},computed:(0,l.A)((0,l.A)({},(0,m.L8)(["user","isAuthenticated"])),{},{currentRules:function(){return this.isAuthenticated?this.rules:this.guestRules}}),created:function(){this.fetchMessages(),this.initUserInfo()},methods:{initUserInfo:function(){this.isAuthenticated&&this.user&&(this.messageForm.nickname=this.user.nickname||this.user.username||"",this.messageForm.email=this.user.email||"",this.replyForm.nickname=this.user.nickname||this.user.username||"",this.replyForm.email=this.user.email||"")},fetchMessages:function(){var e=this;return(0,i.A)((0,n.A)().m(function t(){var a,s,r,i,l;return(0,n.A)().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,e.loading=!0,t.n=1,c.A.message.getList({current:e.currentPage,size:e.pageSize});case 1:a=t.v,200===a.code&&(a.data&&Array.isArray(a.data.records)?(s=a.data.records||[],r=s.filter(function(e){return!e.parentId}),i=s.filter(function(e){return e.parentId}),e.messages=r.map(function(t){var a=i.filter(function(e){return e.parentId===t.id});return{id:t.id,nickname:t.nickname,avatar:t.avatar||"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",time:e.formatDate(t.createTime),content:t.content,likes:t.likes||0,isLiked:t.isLiked||!1,replies:a.map(function(a){return{id:a.id,nickname:a.nickname,avatar:a.avatar||"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",time:e.formatDate(a.createTime),content:a.content,replyToNickname:a.replyToNickname||t.nickname}})}}),e.total=r.length):(e.messages=[],e.total=0,console.warn("留言数据格式不正确:",a.data))),t.n=3;break;case 2:t.p=2,l=t.v,console.error("获取留言列表失败:",l),e.messages=[],e.total=0;case 3:return t.p=3,e.loading=!1,t.f(3);case 4:return t.a(2)}},t,null,[[0,2,3,4]])}))()},submitMessage:function(){var e=this;return(0,i.A)((0,n.A)().m(function t(){return(0,n.A)().w(function(t){while(1)switch(t.n){case 0:e.$refs.messageForm.validate(function(){var t=(0,i.A)((0,n.A)().m(function t(a){var s,r;return(0,n.A)().w(function(t){while(1)switch(t.p=t.n){case 0:if(!a){t.n=5;break}return t.p=1,t.n=2,c.A.message.add(e.messageForm);case 2:s=t.v,200===s.code&&(e.$message.success("留言提交成功！"),e.messageForm.content="",e.isAuthenticated||(e.messageForm.nickname="",e.messageForm.email=""),e.fetchMessages()),t.n=4;break;case 3:t.p=3,r=t.v,console.error("提交留言失败:",r),e.$message.error("提交留言失败");case 4:t.n=6;break;case 5:return t.a(2,!1);case 6:return t.a(2)}},t,null,[[1,3]])}));return function(e){return t.apply(this,arguments)}}());case 1:return t.a(2)}},t)}))()},handlePageChange:function(e){this.currentPage=e,this.fetchMessages()},toggleReplyInput:function(e){this.replyingTo===e?this.cancelReply():(this.replyingTo=e,this.replyForm.content="",this.initUserInfo())},cancelReply:function(){this.replyingTo=null,this.replyForm={nickname:"",email:"",content:""},this.initUserInfo()},submitReply:function(e){var t=this;return(0,i.A)((0,n.A)().m(function a(){var s,r,i,l;return(0,n.A)().w(function(a){while(1)switch(a.p=a.n){case 0:if(s=!0,t.replyForm.content.trim()||(t.$message.error("请输入回复内容"),s=!1),t.isAuthenticated||(t.replyForm.nickname.trim()||(t.$message.error("请输入昵称"),s=!1),t.replyForm.email.trim()||(t.$message.error("请输入邮箱"),s=!1)),s){a.n=1;break}return a.a(2);case 1:return t.replySubmitting=!0,a.p=2,r={parentId:e.id,nickname:t.replyForm.nickname,email:t.replyForm.email,content:t.replyForm.content},a.n=3,c.A.message.add(r);case 3:i=a.v,200===i.code&&(t.$message.success("回复成功！"),t.cancelReply(),t.fetchMessages()),a.n=5;break;case 4:a.p=4,l=a.v,console.error("回复失败:",l),t.$message.error("回复失败");case 5:return a.p=5,t.replySubmitting=!1,a.f(5);case 6:return a.a(2)}},a,null,[[2,4,5,6]])}))()},formatDate:function(e){if(!e)return"";var t=new Date(e);return"".concat(t.getFullYear(),"-").concat(String(t.getMonth()+1).padStart(2,"0"),"-").concat(String(t.getDate()).padStart(2,"0")," ").concat(String(t.getHours()).padStart(2,"0"),":").concat(String(t.getMinutes()).padStart(2,"0"))}}},u=o;var p=a(81656),g=(0,p.A)(u,s,r,!1,null,"1e5dacef",null);const d=g.exports}}]);
//# sourceMappingURL=48.2bddbd72.js.map